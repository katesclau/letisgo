(()=>{typeof window.ratingState>"u"&&(window.ratingState=new WeakMap);(function(){function v(e){if(!e)return;let a=window.ratingState.get(e);a&&m(e,a),e.dataset.ratingInitialized="true";let t={value:parseFloat(e.dataset.initialValue)||0,precision:parseFloat(e.dataset.precision)||1,readonly:e.dataset.readonly==="true",name:e.dataset.name||"",onlyInteger:e.dataset.onlyinteger==="true",maxValue:0},s=e.querySelector("[data-rating-input]"),c=Array.from(e.querySelectorAll("[data-rating-item]")),r=t.value,u=0,f={click:L,mouseover:x,mouseleave:A};function y(){let i=0;for(let n of c){let o=parseInt(n.dataset.ratingValue,10);!isNaN(o)&&o>i&&(i=o)}t.maxValue=Math.max(1,i),r=Math.max(0,Math.min(t.maxValue,r)),r=Math.round(r/t.precision)*t.precision,g()}function g(){s&&(s.value=r.toFixed(2))}function d(i){for(let n of c){let o=parseInt(n.dataset.ratingValue,10);if(isNaN(o))continue;let b=n.querySelector("[data-rating-item-foreground]");if(!b)continue;let l=i>0?i:r,S=o<=Math.floor(l),M=!S&&o-1<l&&l<o,q=M?(l-Math.floor(l))*100:0;b.style.width=S?"100%":M?`${q}%`:"0%"}}function V(i){if(t.readonly)return;let n=i;t.onlyInteger?n=Math.round(n):r===n&&n%1===0?n=Math.max(0,n-t.precision):n=Math.round(n/t.precision)*t.precision,r=Math.max(0,Math.min(t.maxValue,n)),u=0,g(),d(0),e.dispatchEvent(new CustomEvent("rating-change",{bubbles:!0,detail:{name:t.name,value:r,maxValue:t.maxValue}})),s&&(s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})))}function x(i){if(t.readonly)return;let n=i.target.closest("[data-rating-item]");n&&(u=parseInt(n.dataset.ratingValue,10),isNaN(u)||d(u))}function A(){t.readonly||(u=0,d(0))}function L(i){if(t.readonly)return;let n=i.target.closest("[data-rating-item]");if(!n)return;let o=parseInt(n.dataset.ratingValue,10);isNaN(o)||V(o)}if(y(),d(0),t.readonly){e.style.cursor="default";for(let i of c)i.style.cursor="default"}else e.addEventListener("click",f.click),e.addEventListener("mouseover",f.mouseover),e.addEventListener("mouseleave",f.mouseleave);let w=new MutationObserver(()=>{try{e.querySelectorAll("[data-rating-item]").length!==c.length&&(c=Array.from(e.querySelectorAll("[data-rating-item]")),y(),d(u>0?u:0))}catch(i){console.error("Error in rating MutationObserver:",i)}});w.observe(e,{childList:!0,subtree:!0});let I={handlers:f,observer:w,items:c};window.ratingState.set(e,I)}function m(e,a){!e||!a||(!e.dataset.readonly==="true"&&(e.removeEventListener("click",a.handlers.click),e.removeEventListener("mouseover",a.handlers.mouseover),e.removeEventListener("mouseleave",a.handlers.mouseleave)),a.observer&&a.observer.disconnect(),window.ratingState.delete(e),e.removeAttribute("data-rating-initialized"))}function h(e=document){e instanceof Element&&e.matches("[data-rating-component]")&&v(e),e&&typeof e.querySelectorAll=="function"&&e.querySelectorAll("[data-rating-component]").forEach(v)}let p=e=>{let a=e.detail.target||e.detail.elt;a instanceof Element&&requestAnimationFrame(()=>h(a))};document.addEventListener("DOMContentLoaded",()=>h()),document.body.addEventListener("htmx:beforeCleanup",e=>{let a=e.detail.elt;if(a instanceof Element){if(a.matches&&a.matches("[data-rating-component][data-rating-initialized]")){let t=window.ratingState.get(a);t&&m(a,t)}if(a.querySelectorAll)for(let t of a.querySelectorAll("[data-rating-component][data-rating-initialized]")){let s=window.ratingState.get(t);s&&m(t,s)}}}),document.body.addEventListener("htmx:afterSwap",p),document.body.addEventListener("htmx:oobAfterSwap",p)})();})();
